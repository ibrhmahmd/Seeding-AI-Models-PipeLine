# Seeding Pipeline Plan

This document outlines the automated workflow for extracting, enriching, mapping, handling tag IDs (including missing tags), and seeding AI model metadata from Ollama into the target system.

---

## 1. Extraction
- **Goal:** Extract metadata for all locally installed Ollama models.
- **How:** Use `ollama_data_extractor.py` to generate a JSON payload for each model in `data/processed/`.
- **Output:**
  - **Raw model JSON files** are obtained directly from Ollama (these are unmodified and may lack tags or required attributes).
  - **Processed/mapped model JSON files** are created after adding tags and filling in missing attributes; these are stored in `data/processed/` and are ready for enrichment.
  - Any missing tags are listed in `newly_missing_tags.txt`.

---

## 2. Model Enrichment
- **Goal:** Enrich all processed model files with Hugging Face (or dummy) metadata.
- **How:**
  - Use `scripts/enrich_with_hf_metadata.py` to add real or dummy `description`, `referenceLink`, `imageUrl`, and `size` fields to each model JSON.
  - Enriched files are saved to `data/enriched/`.
  - Review `logs/enrich_with_hf_metadata.log` for warnings or errors.

---

## 3. Tag Mapping & Tag Seeding
- **Goal:** Ensure every tag referenced in the enriched model payloads is seeded and has a valid tag ID in `Tags/created_tag_ids.json`.
- **How:**
  1. **Tag Extraction:**
     - Extract all unique tags from the enriched model payloads and log any missing tags in `newly_missing_tags.txt`.
  2. **Tag Seeding:**
     - Use `Tags/create_missing_tags.py` or `Tags/create_remaining_tags.py` to seed any missing tags to the API/system.
     - Tag IDs are generated by the system when tags are seeded successfully.
     - After seeding, update `Tags/created_tag_ids.json` with the new tag IDs.
  3. **Verification:**
     - Ensure all tags referenced in the enriched model payloads now have valid IDs in `Tags/created_tag_ids.json` before proceeding.

---

## 4. Data Remapping (Model Mapping)
- **Goal:** Ensure all enriched model payloads reference valid tag IDs and are in the accurate schema for seeding.
- **How:**
  - After all tags are seeded and `created_tag_ids.json` is up to date, re-map the model data so that all tag references use the correct IDs.
  - Update the model payloads in `data/enriched/` to match the required API schema.

---

## 5. Seeding Models
- **Goal:** Seed all valid, fully-mapped model payloads to the API endpoint.
- **How:**
  - Use `seed_models.py` to POST each payload in `data/enriched/` to the API.
  - Log successes and failures in `logs/seed_models_log.txt`.
  - **After successful seeding, it is mandatory to move the corresponding enriched model payload file (not the raw file) to an `archive/` directory for record-keeping and to keep the `enriched` folder clean.**

---

## 6. Reporting & Cleanup
- **Goal:** Summarize the process and ensure data integrity.
- **How:**
  - Print/log a summary of:
    - Number of models processed
    - Number of tags created and seeded
    - Number of models successfully seeded
    - Any failures or issues
  - Archive processed files as required, or notify the user.

---

## 7. Script Roles & Path Conventions

### Main Scripts and Their Roles
- **scripts/ollama_data_extractor.py**: Extracts and maps model data, writes missing tags.
- **scripts/enrich_with_hf_metadata.py**: Enriches processed model data with Hugging Face or dummy metadata.
- **scripts/prepare_model_data.py**: Prepares pilot batch model data (for manual or batch seeding/testing).
- **scripts/sort_models.py**: Sorts raw model data for prioritization or display.
- **scripts/map_to_api.py**: Maps scraped model data to the API schema using tag IDs.
- **scripts/seed_models.py**: Seeds processed model payloads to the API and logs results.
- **Tags/create_missing_tags.py**: Seeds missing tags from `Tags/missing_tags.md`.
- **Tags/create_remaining_tags.py**: Seeds remaining tags from `Tags/remaining_missing_tags.md`.
- **Tags/create_tags.py** and **Tags/create_tags_gateway.py**: Used for initial or bulk tag creation from proposals.

### Standardized Paths
- **Raw model data:** `data/raw/`
- **Processed/mapped model data:** `data/processed/`
- **Enriched model data:** `data/enriched/`
- **Archive:** `archive/`
- **Tag IDs:** `Tags/created_tag_ids.json`
- **Tag logs:** `Tags/created_tags_log.txt`
- **Missing tags:** `newly_missing_tags.txt`, `Tags/missing_tags.md`, `Tags/remaining_missing_tags.md`
- **Tag proposals:** `Tags/tag_proposal.md`
- **Seeding logs:** `logs/seed_models_log.txt`
- **Enrichment logs:** `logs/enrich_with_hf_metadata.log`

All scripts now use these project-relative paths for portability and consistency.

---
